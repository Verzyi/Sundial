{% extends "builds/base_builds.html" %}
{% block title %} Build Tracking {% endblock title %}
{% block content %}
<div id="build-container">
  <!-- Current Build Info -->
  <div id="build-info" class="build-section">
    <table cellpadding="2">
      <thead style="font-size: 24px; border-bottom: 1px solid #ffffff">
        <tr>
          <th colspan="2">Selected Build Info</th>
        </tr>
      </thead>
      <tbody style="font-size: 14px;"> <!-- Updated font-size to 12px -->
        <tr>
          <td><b>Build ID</b></td>
          <td><span id="buildIdDisplay"></span></td>
        </tr>
        <tr>
          <td><b>Created By</b></td>
          <td><span id="createdByInput"></span></td>
        </tr>
        <tr>
          <td><b>Created On</b></td>
          <td><span id="createdOnInput"></span></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div>
    <div class="row">
      <div id="button-container" class="controlButtons">
        <div id="btn-group" role="group" class="d-flex">
          <!-- New Build Form -->
          <form method="POST" action="{{ url_for('builds.new_build') }}">
            <button class="btn btn-primary" type="submit">
              New Build
            </button>
          </form>

          <!-- Copy Build Form -->
          <form method="POST" action="{{ url_for('builds.copy_build') }}">
            <input type="hidden" name="BuildsID" value="{{ current_build.BuildID }}" />
            <button class="btn btn-primary" type="submit" style="display: none">
              Copy Build
            </button>
          </form>

          <!-- Data Viewer Form -->
          <form method="POST" action="{{ url_for('builds.data_viewer') }}" target="_blank">
            <button type="submit" name="data_viewer" class="btn btn-primary">
              Data Viewer
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Button Status -->
    <div class="column">
      <div class="build-state-buttons">
        <div>
          <input class="btn-check" type="checkbox" name="buildState" id="buildSetupCheckbox" data-toggle="collapse"
                 data-target="#buildSetupForm" />
          <label class="btn btn-outline-primary" for="buildSetupCheckbox" style="display: none">Build Setup</label>
        </div>
        <div class="build-state-buttons">
          <div>
            <input class="btn-check" type="checkbox" name="buildState" id="buildStartCheckbox" data-toggle="collapse"
                   data-target="#buildStartForm" />
            <label class="btn btn-outline-primary" for="buildStartCheckbox" style="display: none">Build Start</label>
          </div>
        </div>
        <div class="build-state-buttons">
          <div>
            <input class="btn-check" type="checkbox" name="buildState" id="buildFinishCheckbox" data-toggle="collapse"
                   data-target="#buildformFinshed" />
            <label class="btn btn-outline-primary" for="buildFinishCheckbox" style="display: none">Build Finish</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Build Search Table + Setup/Start/Finish Forms -->
<div class="container" style="margin:0 ; padding:0;">
  <!-- Build Search Table -->
  <div class="row">
    <div class="col-md-6">
      <div class="searchBuilds">
        <form id="facilityForm">
          <div class="dropdown-content">
            <select style="padding: 5px; margin-bottom: 5px; width: 250px" class="form-select text-center"
                    id="facilitySelectInput" name="facilitySelectInput">
              <option value="" disabled selected>Select Facility</option>
              <option value="Austin">Austin</option>
              <option value="Belton">Belton</option>
              <option value="Helios">Helios</option>
              <option value="N91">N91</option>
            </select>
          </div>
        </form>

        <input style="width: 250px; padding: 5px" type="text" id="searchInput" oninput="filterBuilds()"
               placeholder="Search builds..." />
        <div class="buildsTable">
          <table style="font-size: 12px" class="table table-hover">
            <thead>
              <tr class="table-active">
                <th style="border: 1px solid #ffffff">BuildID</th>
                <th style="border: 1px solid #ffffff">Build Name</th>
              </tr>
            </thead>
            {% if selectedFacility %}
            <tbody>
              {% for build in buildsInfo %}
              <tr class="table-active" data-buildid="{{ build.BuildID }}" data-layer="{{ build.Layer }}"
                  onclick="showBuildInfo(event)">
                <td style="border: 1px solid #ffffff">
                  {{ build.BuildID }}
                </td>
                <td style="border: 1px solid #ffffff">
                  {{ build.BuildName }}
                </td>
              </tr>
              {% endfor %}
            </tbody>
            {% endif %}
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Setup/Start/Finish Forms -->
  <div class="col-md-6">
    <div id="buildSetupForm" class="collapse">
      <form id="buildformSetup" method="POST">
        <div class="build-setup-form">
          <h5 class="text-center mb-4">Build Setup</h5>
          <div class="row" class="container">
            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center">
                <label for="BuildIDInput" class="form-label2">Build ID</label>
                <input type="text" class="form-control text-center" id="BuildIDInput" name="BuildIDInput" disabled />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="BuildNameInput" class="form-label2">Build Name</label>
                <input type="text" class="form-control text-center" id="BuildNameInput" name="BuildNameInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="machineIdInput" class="form-label2">MachineID</label>
                <select class="form-select text-center" id="machineIdInput" name="machineIdInput">
                  <option value="" disabled selected>Select Machine</option>
                  <!-- Add machine options dynamically -->
                  {% for machine in machines %}
                  <option value="{{ machine }}">{{ machine }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="AlloyNameInput" class="form-label2">Material</label>
                <select class="form-select text-center" id="AlloyNameInput" name="AlloyNameInput">
                  <option value="" disabled selected>
                    Select Material
                  </option>
                  <!-- Add material options dynamically -->
                  {% for material in materials %}
                  <option value="{{ material }}">{{ material }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="ScaleXInput" class="form-label2">Scale X</label>
                <input type="number" class="form-control text-center" step=".001" id="ScaleXInput" name="ScaleXInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="ScaleYInput" class="form-label2">Scale Y</label>
                <input type="number" class="form-control text-center" step=".001" id="ScaleYInput" name="ScaleYInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="OffsetInput" class="form-label2">Offset</label>
                <input type="number" class="form-control text-center" step=".001" id="OffsetInput" name="OffsetInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="LayerInput" class="form-label2">Layer Thickness (µm):</label>
                <input type="number" class="form-control text-center" step="1" id="LayerInput" name="LayerInput" />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center EOS">
                <label for="PlateTemperatureInput" class="form-label2">Plate Temperature (°C)</label>
                <input type="number" class="form-control text-center" step=".01" id="PlateTemperatureInput"
                       name="PlateTemperatureInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="PotentialBuildHeightInput" class="form-label2">Potential Build Height (mm)</label>
                <input type="number" class="form-control text-center" step=".01" id="PotentialBuildHeightInput"
                       name="PotentialBuildHeightInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="MinChargeAmountInput" class="form-label2">Min Charge Amount</label>
                <input type="number" class="form-control text-center" id="MinChargeAmountInput"
                       name="MinChargeAmountInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="MaxChargeAmountInput" class="form-label2">Max Charge Amount</label>
                <input type="number" class="form-control text-center" id="MaxChargeAmountInput"
                       name="MaxChargeAmountInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="DosingBoostAmountInput" class="form-label2">Dosing Boost Amount</label>
                <input type="number" class="form-control text-center" id="DosingBoostAmountInput"
                       name="DosingBoostAmountInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="RecoaterSpeedInput" class="form-label2">Recoater Speed</label>
                <input type="number" class="form-control text-center" id="RecoaterSpeedInput"
                       name="RecoaterSpeedInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="RecoaterTypeInput" class="form-label2">Recoater Type</label>
                <select class="form-select text-center" id="RecoaterTypeInput" name="RecoaterTypeInput">
                  <option value="" disabled selected>
                    Select Recoater type
                  </option>
                  <option value="Blade">Blade</option>
                  <option value="Brush">Brush</option>
                  <option value="Silicone">Silicone (Clear)</option>
                  <option value="NBR">NBR (Black)</option>
                </select>
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="ParameterRevInput" class="form-label2">Parameter Rev</label>
                <div style="display:block">
                  <input type="text" class="form-control" id="parameterRevDisplay" name="parameterRevDisplay"
                         disabled />
                </div>
                <div class="input-group">
                  <div class="custom-file">
                    <input type="file" class="custom-file-input" id="ParameterRevInput" name="ParameterRevInput" />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <button class="btn-primary" name="buildformSetup" style="height: 30px; width: 100%">
            Submit
          </button>
        </div>
      </form>
    </div>

    <div id="buildStartForm" class="collapse">
      <form id="buildformStart" method="POST">
        <div class="build-start-form">
          <h5 class="text-center mb-4">Build Start</h5>
          <div class="row" class="container">
            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center">
                <label for="blendIdInput" class="form-label2">BlendID</label>
                <input type="number" class="form-control text-center" id="blendIdInput" name="blendIdInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="PlateSerialInput" class="form-label2">Plate Serial</label>
                <input type="text" class="form-control text-center" oninput="formatPlateSerial(this)" maxlength="10"
                       id="PlateSerialInput" name="PlateSerialInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="PlateThicknessInput" class="form-label2">Plate Thickness (mm)</label>
                <input type="number" class="form-control text-center" step='0.01' id="PlateThicknessInput"
                       name="PlateThicknessInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="PlateWeightInput" class="form-label2">Plate Weight (kg)</label>
                <input type="number" class="form-control text-center" step='0.01' id="PlateWeightInput"
                       name="PlateWeightInput" />
              </div>

              <div class="mb-3 form-label2 text-center Velo">
                <label for="InSpec" class="form-label2">Machine in Spec?</label>
                <select class="form-select text-center" id="InSpec" name="InSpec">
                  <option value="" disabled>
                    Machine in Spec
                  </option>
                  <option value="True" {% if inSpec==True %} selected {% endif %}>Yes</option>
                  <option value="False" {% if inSpec==False %} selected {% endif %}>No</option>
                </select>
              </div>

              <div class="mb-3 form-label2 text-center EOS">
                <label for="FeedPowderHeightInput" class="form-label2">Feed Powder Height (mm)</label>
                <input type="number" class="form-control text-center" id="FeedPowderHeightInput"
                       name="FeedPowderHeightInput" step='0.01' />
              </div>
            </div>

            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center">
                <label for="InertTimeInput" class="form-label2">Inert Time</label>
                <input type="datetime-local" class="form-control text-center" id="InertTimeInput"
                       name="InertTimeInput" />
              </div>
              <div class="mb-3 form-label2 text-center Velo">
                <label for="PowderLevelInput" class="form-label2">Powder Level</label>
                <input type="number" class="form-control text-center" id="PowderLevelInput" name="PowderLevelInput" />
              </div>
              <div class="mb-3 form-label2 text-center Velo">
                <label for="SieveLifeInput" class="form-label2">Sieve Life (layers remaining)</label>
                <input type="number" class="form-control text-center" id="SieveLifeInput" name="SieveLifeInput" />
              </div>
              <div class="mb-3 form-label2 text-center Velo">
                <label for="FilterPressureDropInput" class="form-label2">Filter Pressure Drop (kPa)</label>
                <input type="number" class="form-control text-center" id="FilterPressureDropInput" step="0.01"
                       name="FilterPressureDropInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="F9FilterSerialInput" class="form-label2">F9 Filter Serial</label>
                <input type="text" class="form-control text-center" id="F9FilterSerialInput"
                       name="F9FilterSerialInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="H13FilterSerialInput" class="form-label2">H13 Filter Serial:</label>
                <input type="text" class="form-control text-center" id="H13FilterSerialInput"
                       name="H13FilterSerialInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="StartLaserHoursInput" class="form-label2">Start Laser Hours</label>
                <input type="number" class="form-control text-center" id="StartLaserHoursInput"
                       name="StartLaserHoursInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="BuildStartTimeInput" class="form-label2">Build Start Time</label>
                <input type="datetime-local" class="form-control text-center" id="BuildStartTimeInput"
                       name="BuildStartTimeInput" />
              </div>
            </div>
          </div>
          <button class="btn-primary" name="buildformStart" style="height: 30px; width: 100%">
            Submit
          </button>
        </div>
      </form>
    </div>

    <div id="buildformFinshed" class="collapse">
      <form id="buildformFinish" method="POST">
        <div class="build-finish-form">
          <h5 class="text-center mb-4">Build Finish</h5>
          <div class="row" class="container">
            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center">
                <label for="MaterialAddedInput" class="form-label2">Material Added?</label>
                <select class="form-select text-center" id="MaterialAddedInput" name="MaterialAddedInput">
                  <option value="" disabled>
                    Select Material Added
                  </option>
                  <option value="True" {% if MaterialAddedInput=='True' %} selected {% endif %}>Yes</option>
                  <option value="False" {% if MaterialAddedInput=='False' %} selected {% endif %}>No</option>
                </select>
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="BuildFinishTimeInput" class="form-label2">Build Finish Time</label>
                <input type="datetime-local" class="form-control text-center" id="BuildFinishTimeInput"
                       name="BuildFinishTimeInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="BuildTimeInput" class="form-label2">Build Time (hrs)</label>
                <input type="number" class="form-control text-center" id="BuildTimeInput" name="BuildTimeInput"
                       step='0.001' />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="FinalLaserHoursInput" class="form-label2">Final Laser Hours</label>
                <input type="number" class="form-control text-center" id="FinalLaserHoursInput"
                       name="FinalLaserHoursInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="FinishHeightInput" class="form-label2">Build Finish Height (mm)</label>
                <input type="number" class="form-control text-center" id="FinishHeightInput" name="FinishHeightInput"
                       step='0.01' />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3 form-label2 text-center EOS">
                <label for="EndPartPistonHeightInput" class="form-label2">End Part Piston Height (mm)</label>
                <input type="number" class="form-control text-center" id="EndPartPistonHeightInput"
                       name="EndPartPistonHeightInput" />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="EndFeedPowderHeightInput" class="form-label2">End Feed Powder Height (mm)</label>
                <input type="number" class="form-control text-center" id="EndFeedPowderHeightInput"
                       name="EndFeedPowderHeightInput" step='0.01' />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="BreakoutTimeInput" class="form-label2">Breakout Time</label>
                <input type="datetime-local" class="form-control text-center" id="BreakoutTimeInput"
                       name="BreakoutTimeInput" />
              </div>
              <div class="mb-3 form-label2 text-center">
                <label for="FinishPlateWeightInput" class="form-label2">Finish Plate Weight (kg)</label>
                <input type="number" class="form-control text-center" id="FinishPlateWeightInput"
                       name="FinishPlateWeightInput" step='0.01' />
              </div>
              <div class="mb-3 form-label2 text-center EOS">
                <label for="BuildInterruptsInput" class="form-label2">Build Interrupts?</label>
                <select class="form-select text-center" id="BuildInterruptsInput" name="BuildInterruptsInput">
                  <option value="" disabled>
                    Select Build Interrupts
                  </option>
                  <option value="True" {% if BuildInterruptsInput=='True' %} selected {% endif %}>Yes</option>
                  <option value="False" {% if BuildInterruptsInput=='False' %} selected {% endif %}>No</option>
                </select>
              </div>
            </div>
          </div>
          <button class="btn-primary" style="height: 30px; width: 100%" name="buildformFinish">
            Submit
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="{{ url_for('static', filename='js/builds.js') }}"></script>
{% endblock content %}